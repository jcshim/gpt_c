## 10장. 동적 메모리 — malloc으로 메모리를 직접 만들다

---

### 1. 왜 동적 메모리가 필요할까?

지금까지 우리는 이렇게 써 왔다.

```c
int a[10];
```

👉 문제점

* 크기가 **미리 고정**
* 실행 중에 **늘리거나 줄일 수 없다**

그래서 등장한 것이 **동적 메모리 할당**이다.

---

### 2. 동적 메모리란?

* **실행 중(runtime)** 에
* 필요한 만큼 메모리를
* **직접 요청**해서 사용

C에서는 이 일을 **malloc / free**가 담당한다.

---

### 3. malloc 기본 사용법

```c
#include <stdlib.h>

int *p = (int *)malloc(sizeof(int));
```

* `malloc` : 메모리 요청
* `sizeof(int)` : 필요한 바이트 수
* 반환값 : **주소**
* 그래서 반드시 **포인터**로 받는다

---

### 4. 값 사용하기

```c
*p = 10;
printf("%d\n", *p);
```

👉 일반 변수처럼 사용 가능

---

### 5. 꼭 해야 할 일 — free

```c
free(p);
```

* 사용이 끝난 메모리는 반드시 해제
* 안 하면 **메모리 누수(memory leak)**

---

### 6. 배열을 동적으로 만들기

```c
int n = 5;
int *arr = (int *)malloc(sizeof(int) * n);
```

사용:

```c
for(int i=0;i<n;i++)
    arr[i] = i * 10;
```

---

### 7. 배열 출력 예제

```c
for(int i=0;i<n;i++)
    printf("%d ", arr[i]);
```

---

### 8. realloc — 크기 변경

```c
arr = (int *)realloc(arr, sizeof(int) * 10);
```

* 기존 데이터 유지
* 크기만 변경

👉 **동적 배열의 핵심**

---

### 9. malloc 실패 체크 (중요)

```c
int *p = malloc(sizeof(int));
if (p == NULL) {
    printf("메모리 할당 실패\n");
    return 1;
}
```

---

### 10. 구조체 + 동적 메모리

```c
typedef struct {
    int x;
    int y;
} Point;

Point *p = (Point *)malloc(sizeof(Point));
p->x = 3;
p->y = 4;
```

---

### 11. 연결 리스트의 시작점

```c
typedef struct Node {
    int data;
    struct Node *next;
} Node;

Node *n = (Node *)malloc(sizeof(Node));
n->data = 10;
n->next = NULL;
```

👉 리스트, 트리의 **출발점**

---

### 12. 스택 메모리 vs 힙 메모리

| 구분 | 스택 | 힙        |
| -- | -- | -------- |
| 생성 | 자동 | malloc   |
| 해제 | 자동 | free     |
| 크기 | 작음 | 큼        |
| 속도 | 빠름 | 상대적으로 느림 |

---

### 13. 자주 나오는 실수

❌ free 안 함
❌ free 후 다시 사용
❌ free 두 번 호출

```c
free(p);
*p = 10; // ❌ 위험
```

---

### 14. 안전한 패턴

```c
free(p);
p = NULL;
```

---

### 15. malloc 한 줄 요약

👉 **malloc = 메모리 요청**
👉 **포인터로 받는다**
👉 **사용 후 free**

---

### 16. GPT에게 이렇게 질문하자

> 💬 “malloc과 배열 차이를 예제로 설명해 줘”
> 💬 “realloc 동작 과정 그림으로 보여줘”
> 💬 “메모리 누수 예시 만들어 줘”

---

### 17. 지금 단계에서 할 수 있어야 할 것

* malloc / free 정확히 사용
* 동적 배열 생성
* 구조체 + malloc
* 포인터와 힙 메모리 구분

---

### 18. 이 책을 마치며

이제 당신은

* **문법을 외우는 사람**이 아니라
* **질문하며 코딩하는 사람**
* **GPT와 대화하며 문제를 해결하는 사람**

C언어는 끝났고,
**이제는 스스로 배우는 힘**이 남았다.

👉 다음 프로젝트는
**당신의 질문에서 시작된다.**
